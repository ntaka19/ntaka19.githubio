---
layout: default
---

<div class="story">
  {% for post in site.stories %}
    <article class="story">

      <h1><a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a></h1>

      <div class="entry">
        {{ post.excerpt }}
      </div>

      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

      <a href="{{ site.baseurl }}{{ post.url }}" class="read-more">Read More</a>
      
      <div class="tags">
        {% for tag in post.tags %}
          <div class="tag {{tag}}">{{tag}}</div>
        {% endfor %}
      </div>

    </article>
  {% endfor %}
</div>

<div id="tag-pane">
<p class="filter-caption">
    Filter by tag:
    </p>
</div>

	<script>
		var getTagNamesFromPost = function(post){
			var tags = post.querySelectorAll(".tag");
			var tagNames = [];
				for(var i = 0; i < tags.length; i++)
				{
					var tag = tags[i];
					var tagName = tag.classList[1];
					tagNames.push(tagName);
				}
			return tagNames;
		}

		var getTagsAndstories = function(stories){
			var allTagNames = [];
			var tagsAndstories = {};

			for(var i = 0; i < stories.length; i++)
			{
				var post = stories[i];

				var tagNames = getTagNamesFromPost(post);
				for(var j = 0; j < tagNames.length; j++)
				{
					var tagName = tagNames[j];
					allTagNames.push(tagName)

					if(tagsAndstories[tagName] === undefined)
						tagsAndstories[tagName] = [i];
					else
						tagsAndstories[tagName].push(i);
				}
			}

			return tagsAndstories;
		};
		var addClass = function(element, className){
			if (element.classList)
				element.classList.add(className);
			else
				element.className += ' ' + className;
		};

		var hideAllstories = function(stories){
			for(var i = 0; i < stories.length; i++)
			{
				stories[i].style.display = 'none';
			}
		};

		var displaystories = function(allstories, storiesToDisplay){
			hideAllstories(allstories);

			for(var i = 0; i < storiesToDisplay.length; i++)
			{
				var indexToShow = storiesToDisplay[i];
				allstories[indexToShow].style.display = '';
			}
		};

		var hasClass = function(element, cls) {
			return (' ' + element.className + ' ').indexOf(' ' + cls + ' ') > -1;
		};

		var removeClass = function(element, className){
			element.className = element.className.replace(className, "");
		};

		var removeSelectedClassFromAllTags = function(tagsAndTagSelectorElements, selectedClass){
			for(var tagName in tagsAndTagSelectorElements)
			{
				if(tagsAndTagSelectorElements.hasOwnProperty(tagName))
				{
					removeClass(tagsAndTagSelectorElements[tagName], selectedClass);
				}
			}
		};

		document.addEventListener("DOMContentLoaded", function(event) { 
			var stories = document.querySelectorAll('.post');
			var tagsAndstories = getTagsAndstories(stories);

			var divElement = document.createElement("div");
			addClass(divElement, "tag-selectors");

			var clearText = "clear";
			var clearTagsElement = document.createElement("p");
			addClass(clearTagsElement, "clear-tags");
			clearTagsElement.innerText = clearText;
			divElement.appendChild(clearTagsElement);

			var selectedClass = "selected";

			var tagsAndTagSelectorElements = {}
			tagsAndTagSelectorElements[clearText] = clearTagsElement;

			for(var tagName in tagsAndstories)
			{
				if(tagsAndstories.hasOwnProperty(tagName))
				{
					var storiesContainingTag = tagsAndstories[tagName];
					var numberOfstories = storiesContainingTag.length;
					var classToAdd = "count-" + numberOfstories;

					var tagPElement = document.createElement("p");
					addClass(tagPElement, "tag-selector");
					addClass(tagPElement, classToAdd);
					tagPElement.textContent = tagName;

					tagsAndTagSelectorElements[tagName] = tagPElement;

					divElement.appendChild(tagPElement);
				}
			}

			var clearShowing = "showing";

			for(var tagName in tagsAndTagSelectorElements)
			{
				if(tagsAndTagSelectorElements.hasOwnProperty(tagName))
				{
					tagsAndTagSelectorElements[tagName]
						.addEventListener("click", 
						function(eventObj) {
							var tagName = eventObj.currentTarget.innerText;

							removeSelectedClassFromAllTags(tagsAndTagSelectorElements, selectedClass);

							if(tagName === clearText)
							{
								removeClass(clearTagsElement, clearShowing);
								var allstories = [];
								for(var n = 0; n < stories.length; n++)
									allstories.push(n);

								displaystories(stories, allstories);
								return;
							}
							addClass(clearTagsElement, clearShowing);
							addClass(tagsAndTagSelectorElements[tagName], selectedClass);
							var storiesToShow = tagsAndstories[tagName];
							displaystories(stories, storiesToShow);
						});
				}
			}

			var tagPaneElement = document.getElementById("tag-pane");
			tagPaneElement.appendChild(divElement);
		});
	</script>
